//// ------------------------------------------------------
//// THIS FILE WAS AUTOMATICALLY GENERATED (DO NOT MODIFY)
//// ------------------------------------------------------

Project "Podkrepi.bg" {
  database_type: 'PostgreSQL'
  Note: ''
}

Table people {
  id String [pk]
  firstName String [not null]
  lastName String [not null]
  email String [unique, not null]
  phone String
  picture String
  company String
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
  newsletter Boolean [default: false]
  address String
  birthday DateTime
  emailConfirmed Boolean [default: false]
  personalNumber String [unique, note: 'Uniform Civil Number (NCN, EGN)
https://en.wikipedia.org/wiki/National_identification_number#Bulgaria']
  keycloakId String [unique]
  stripeCustomerId String [unique]
  benefactors Benefactor [not null]
  beneficiaries Beneficiary [not null]
  campaigns Campaign [not null]
  organizer Organizer [not null]
  coordinators Coordinator [not null]
  documents Document [not null]
  Donation Donation [not null]
  expenses Expense [not null]
  infoRequests InfoRequest [not null]
  recurringDonations RecurringDonation [not null]
  supporters Supporter [not null]
  transfers Transfer [not null]
  withdrawals Withdrawal [not null]
  campaignFiles CampaignFile [not null]
  irregularities Irregularity [not null]
  irregularityFiles IrregularityFile [not null]

  Note: 'Generic person object'
}

Table companies {
  id String [pk]
  companyName String [not null]
  companyNumber String [unique, not null, note: 'BULSTAT Unified Identification Code (UIC)
https://psc.egov.bg/en/psc-starting-a-business-bulstat']
  legalPersonName String
  countryCode String
  cityId String
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
  beneficiaries Beneficiary [not null]
}

Table organizers {
  id String [pk]
  personId String [unique, not null]
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
  person Person [not null]
  campaigns Campaign [not null]

  Note: 'Organizer is the person who manages the campaign on behalf of the Beneficiary'
}

Table coordinators {
  id String [pk]
  personId String [unique, not null]
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
  person Person [not null]
  beneficiaries Beneficiary [not null]
  campaigns Campaign [not null]

  Note: 'Coordinator is the person who manages the campaign on behalf of Podkrepi.bg'
}

Table benefactors {
  id String [pk]
  personId String [not null]
  extCustomerId String [unique, note: 'Payment provider customer id']
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
  person Person [not null]

  Note: 'Benefactor is the person who gives money'
}

Table beneficiaries {
  id String [pk]
  type BeneficiaryType [not null]
  personId String [note: 'Person in need when type is `individual`']
  coordinatorId String [not null, note: 'Coordinator for this beneficiary']
  countryCode String [not null]
  cityId String [not null]
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
  coordinatorRelation PersonRelation [not null, default: 'none']
  description String
  privateData Json
  publicData Json
  companyId String [note: 'Company in need when type is `company`']
  city City [not null]
  company Company
  coordinator Coordinator [not null]
  person Person
  campaigns Campaign [not null]

  Note: 'Beneficiary is the person who receives the benefit'
}

Table campaign_types {
  id String [pk]
  category CampaignTypeCategory [not null, default: 'others']
  name String [not null]
  slug String [unique, not null]
  description String
  parentId String
  parent CampaignType
  children CampaignType [not null]
  campaigns Campaign [not null]
}

Table campaigns {
  id String [pk]
  state CampaignState [not null, default: 'draft']
  slug String [unique, not null]
  title String [not null]
  essence String [not null]
  paymentReference String [unique, not null]
  organizerId String
  coordinatorId String [not null]
  beneficiaryId String [not null]
  campaignTypeId String [not null]
  description String
  targetAmount Int [default: 0]
  allowDonationOnComplete Boolean [not null, default: false]
  startDate DateTime
  endDate DateTime
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
  deletedAt DateTime
  approvedById String
  currency Currency [not null, default: 'BGN']
  approvedBy Person
  organizer Organizer
  beneficiary Beneficiary [not null]
  campaignType CampaignType [not null]
  coordinator Coordinator [not null]
  outgoingTransfers Transfer [not null]
  incomingTransfers Transfer [not null]
  vaults Vault [not null]
  withdrawals Withdrawal [not null]
  campaignFiles CampaignFile [not null]
  irregularities Irregularity [not null]
}

Table irregularities {
  id String [pk]
  campaignId String [not null]
  personId String [not null]
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
  status IrregularityStatus [not null, default: 'initial']
  reason IrregularityReason [not null, default: 'other']
  notifierType NotifierType [not null, default: 'other']
  description String [not null]
  campaign Campaign [not null]
  person Person [not null]
  files IrregularityFile [not null]
}

Table campaign_files {
  id String [pk]
  filename String [not null]
  mimetype String [not null]
  campaignId String [not null]
  personId String [not null]
  role CampaignFileRole [not null]
  campaign Campaign [not null]
  person Person [not null]
}

Table irregularity_files {
  id String [pk]
  filename String [not null]
  mimetype String [not null]
  irregularityId String [not null]
  uploaderId String [not null]
  irregularity Irregularity [not null]
  uploadedBy Person [not null]
}

Table info_requests {
  id String [pk]
  personId String [not null]
  message String [not null]
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
  deletedAt DateTime
  person Person [not null]
}

Table supporters {
  id String [pk]
  personId String [not null]
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
  deletedAt DateTime
  comment String
  associationMember Boolean [not null, default: false]
  benefactorCampaign Boolean [not null, default: false]
  benefactorPlatform Boolean [not null, default: false]
  companyOtherText String
  companySponsor Boolean [not null, default: false]
  companyVolunteer Boolean [not null, default: false]
  partnerBussiness Boolean [not null, default: false]
  partnerNpo Boolean [not null, default: false]
  partnerOtherText String
  roleAssociationMember Boolean [not null, default: false]
  roleBenefactor Boolean [not null, default: false]
  roleCompany Boolean [not null, default: false]
  rolePartner Boolean [not null, default: false]
  roleVolunteer Boolean [not null, default: false]
  volunteerBackend Boolean [not null, default: false]
  volunteerDesigner Boolean [not null, default: false]
  volunteerDevOps Boolean [not null, default: false]
  volunteerFinancesAndAccounts Boolean [not null, default: false]
  volunteerFrontend Boolean [not null, default: false]
  volunteerLawyer Boolean [not null, default: false]
  volunteerMarketing Boolean [not null, default: false]
  volunteerProjectManager Boolean [not null, default: false]
  volunteerQa Boolean [not null, default: false]
  volunteerSecurity Boolean [not null, default: false]
  person Person [not null]
}

Table cities {
  id String [pk]
  name String [not null]
  postalCode String [unique, not null]
  countryId String [not null]
  countryCode Country [not null]
  beneficiaries Beneficiary [not null]
}

Table countries {
  id String [pk]
  name String [not null]
  countryCode String [unique, not null]
  cities City [not null]
}

Table vaults {
  id String [pk]
  name String [not null, default: '']
  currency Currency [not null, default: 'BGN']
  amount Int [not null, default: 0]
  blockedAmount Int [not null, default: 0]
  campaignId String [not null]
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
  campaign Campaign [not null]
  donations Donation [not null]
  expenses Expense [not null]
  recurringDonations RecurringDonation [not null]
  sourceTransfers Transfer [not null]
  targetTransfers Transfer [not null]
  withdraws Withdrawal [not null]
}

Table donations {
  id String [pk]
  type DonationType [not null]
  status DonationStatus [not null, default: 'initial']
  provider PaymentProvider [not null, default: 'none']
  targetVaultId String [not null, note: 'Vault where the funds are going']
  extCustomerId String [not null, note: 'Payment provider attributes']
  extPaymentIntentId String [unique, not null]
  extPaymentMethodId String [not null]
  billingName String
  billingEmail String
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
  amount Int [not null, default: 0]
  chargedAmount Int [not null, default: 0]
  currency Currency [not null, default: 'BGN']
  personId String
  person Person
  targetVault Vault [not null]
}

Table recurring_donations {
  id String [pk]
  status RecurringDonationStatus [not null]
  vaultId String [not null]
  personId String [not null]
  extSubscriptionId String [not null, note: 'Payment provider Subscription id']
  extCustomerId String
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
  amount Int [not null, default: 0]
  currency Currency [not null, default: 'BGN']
  person Person [not null]
  sourceVault Vault [not null]

  Note: 'Donate on monthly basis'
}

Table transfers {
  id String [pk]
  status TransferStatus [not null, default: 'initial']
  currency Currency [not null]
  amount Int [not null, default: 0]
  reason String [not null]
  sourceVaultId String [not null, note: 'Source vault']
  sourceCampaignId String [not null]
  targetVaultId String [not null, note: 'Destination vault']
  targetCampaignId String [not null]
  approvedById String
  documentId String
  targetDate DateTime [default: `now()`]
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
  approvedBy Person
  sourceCampaign Campaign [not null]
  sourceVault Vault [not null]
  targetCampaign Campaign [not null]
  targetVault Vault [not null]

  Note: 'Move funds from one vault to another'
}

Table withdrawals {
  id String [pk]
  status WithdrawStatus [not null, default: 'initial']
  currency Currency [not null]
  amount Int [not null, default: 0]
  reason String [not null]
  sourceVaultId String [not null, note: 'Source vault']
  sourceCampaignId String [not null]
  bankAccountId String [not null, note: 'Destination bank account']
  documentId String
  approvedById String
  targetDate DateTime [default: `now()`]
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
  approvedBy Person
  bankAccount BankAccount [not null]
  sourceCampaign Campaign [not null]
  sourceVault Vault [not null]

  Note: 'Remove funds from a vault to given bank account'
}

Table bank_accounts {
  id String [pk]
  status BankAccountStatus [not null, default: 'new']
  ibanNumber String [not null, note: 'IBAN number']
  accountHolderName String [not null, note: 'Name of account holder']
  accountHolderType AccountHolderType [not null, note: 'Company or individual']
  bankName String [note: 'Bank name']
  bankIdCode String [note: 'Bank Identification Code, BIC/SWIFT code']
  fingerprint String
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
  withdraws Withdrawal [not null]
}

Table expenses {
  id String [pk]
  type ExpenseType [not null]
  status ExpenseStatus [not null]
  currency Currency [not null, default: 'BGN']
  amount Int [not null, default: 0]
  vaultId String [not null]
  deleted Boolean [not null, default: false]
  description String
  documentId String
  approvedById String
  vault Vault [not null]
  approvedBy Person
  document Document

  Note: 'Pay for something from a given vault'
}

Table documents {
  id String [pk]
  type DocumentType [not null]
  name String [not null]
  filename String [not null]
  filetype String
  description String
  sourceUrl String [not null, note: 'Data storage source url']
  ownerId String [not null, note: 'Person who uploaded the document']
  owner Person [not null]
  expenses Expense [not null]
}

Table bank_transactions_files {
  id String [pk]
  filename String [not null]
  mimetype String [not null]
  bankTransactionsFileId String [not null]
  personId String [not null]
  type BankTransactionsFileType [not null, default: 'xml']
}

Enum BeneficiaryType {
  individual
  company
}

Enum PersonRelation {
  none
  parent
  spouse
  child
  mother
  father
  brother
  sister
  friend
  relative
  partner
  domesticPartner
  manager
  assistant
  colleague
  myself
  myorg
}

Enum CampaignState {
  initial
  draft
  pending_validation
  approved
  rejected
  active
  active_pending_validation
  suspended
  complete
  disabled
  error
  deleted
}

Enum Currency {
  BGN
  EUR
  USD
}

Enum ExpenseStatus {
  pending
  approved
  canceled
}

Enum ExpenseType {
  none
  internal
  operating
  administrative
  medical
  services
  groceries
  transport
  accommodation
  shipping
  utility
  rental
  legal
  bank
  advertising
  other
}

Enum PaymentProvider {
  none
  stripe
  paypal
  epay
  bank
  cash
}

Enum DocumentType {
  invoice
  receipt
  medical_record
  other
}

Enum DonationType {
  donation
}

Enum DonationStatus {
  initial
  invalid
  incomplete
  declined
  waiting
  cancelled
  succeeded
  deleted
  refund
  paymentRequested
}

Enum RecurringDonationStatus {
  trialing
  active
  canceled
  incomplete
  incompleteExpired
  pastDue
  unpaid
}

Enum WithdrawStatus {
  initial
  invalid
  incomplete
  declined
  cancelled
  succeeded
}

Enum TransferStatus {
  initial
  invalid
  incomplete
  declined
  cancelled
  succeeded
}

Enum AccountHolderType {
  individual
  company
}

Enum BankAccountStatus {
  new
  validated
  verified
  verification_failed
  errored
}

Enum CampaignTypeCategory {
  medical
  charity
  disasters
  education
  events
  environment
  sport
  art
  nature
  animals
  others
}

Enum CampaignFileRole {
  background
  coordinator
  campaignPhoto
  invoice
  document
  profilePhoto
  campaignListPhoto
  beneficiaryPhoto
  organizerPhoto
}

Enum IrregularityStatus {
  initial
  confirmed
  declined
}

Enum IrregularityReason {
  duplicate
  inappropriate
  illegalActivity
  misinformation
  privacyViolation
  spam
  irrelevant
  political
  discrimination
  explicitContent
  fraud
  other
}

Enum NotifierType {
  benefactor
  other
}

Enum BankTransactionsFileType {
  xml
  other
}

Ref: Organizer.personId > Person.id

Ref: Coordinator.personId > Person.id

Ref: Benefactor.personId > Person.id

Ref: Beneficiary.cityId > City.id

Ref: Beneficiary.companyId > Company.id

Ref: Beneficiary.coordinatorId > Coordinator.id

Ref: Beneficiary.personId > Person.id

Ref: CampaignType.parentId - CampaignType.id

Ref: Campaign.approvedById > Person.id

Ref: Campaign.organizerId > Organizer.id

Ref: Campaign.beneficiaryId > Beneficiary.id

Ref: Campaign.campaignTypeId > CampaignType.id [delete: Cascade]

Ref: Campaign.coordinatorId > Coordinator.id

Ref: Irregularity.campaignId > Campaign.id

Ref: Irregularity.personId > Person.id

Ref: CampaignFile.campaignId > Campaign.id

Ref: CampaignFile.personId > Person.id

Ref: IrregularityFile.irregularityId > Irregularity.id

Ref: IrregularityFile.uploaderId > Person.id

Ref: InfoRequest.personId > Person.id

Ref: Supporter.personId > Person.id

Ref: City.countryId > Country.id

Ref: Vault.campaignId > Campaign.id

Ref: Donation.personId > Person.id

Ref: Donation.targetVaultId > Vault.id

Ref: RecurringDonation.personId > Person.id

Ref: RecurringDonation.vaultId > Vault.id

Ref: Transfer.approvedById > Person.id

Ref: Transfer.sourceCampaignId > Campaign.id

Ref: Transfer.sourceVaultId > Vault.id

Ref: Transfer.targetCampaignId > Campaign.id

Ref: Transfer.targetVaultId > Vault.id

Ref: Withdrawal.approvedById > Person.id

Ref: Withdrawal.bankAccountId > BankAccount.id

Ref: Withdrawal.sourceCampaignId > Campaign.id

Ref: Withdrawal.sourceVaultId > Vault.id

Ref: Expense.vaultId > Vault.id

Ref: Expense.approvedById > Person.id

Ref: Expense.documentId > Document.id

Ref: Document.ownerId > Person.id